const translations = {
  "en": {
    "nav_features": "Features",
    "nav_install": "Installation",
    "nav_download": "Download Alpha",
    "badge_alpha": "Alpha Version Available",
    "hero_title": "The Armored Engine<br>for your Simulation",
    "hero_desc": "A persistent ELD/HOS system, crash-resilient and with complete auditing for American Truck Simulator and Euro Truck Simulator 2.",
    "btn_download": "Download Now",
    "feat_1_title": "Never Lose Progress",
    "feat_1_desc": "Your progress is saved atomically. Game crash or PC shutdown? No problem. SimDuty restores the exact state of your trip.",
    "feat_2_title": "Real Driving Rules",
    "feat_2_desc": "Hours of Service rules (USA, Canada, Brazil, EU) with dynamic switching. Rest, drive, and shift cycles calculated precisely.",
    "feat_3_title": "Trip Proof",
    "feat_3_desc": "Every event is logged in a cryptographically chained Ledger (SHA256). Ideal for VTCs requiring proof of integrity.",
    "dl_ready_title": "Ready to roll?",
    "dl_ready_desc": "Download the latest SimDuty version. Includes the Desktop App and necessary plugins for ATS/ETS2.",
    "dl_btn_zip": "Download .ZIP (Alpha)",
    "dl_compat": "Compatible with Windows 10/11 x64",
    "verify_title": "Security Validation (SHA256)",
    "verify_loading": "Loading hash...",
    "verify_instr": "Check with `Get-FileHash`",
    "verify_btn_copy": "Copy Hash",
    "verify_btn_copied": "Copied!",
    "inst_title": "How to Install",
    "inst_step_1_title": "Extract",
    "inst_step_1_desc": "Unzip <code>SimDuty-Release.zip</code> to a folder of your choice (e.g., <code>Documents/SimDuty</code>).",
    "inst_step_2_title": "Install Plugins",
    "inst_step_2_desc": "Copy the DLLs from the <code>plugins</code> folder to the game plugins folder:",
    "inst_step_3_title": "Run",
    "inst_step_3_desc": "Open <code>SimDuty.exe</code>. The system will automatically detect the game when you enter the cabin.",
    "footer_rights": "&copy; 2026 SimDuty Project. Distributed under MIT License.<br>Not affiliated with SCS Software.",
    "footer_roadmap": "Roadmap",
    "footer_bug": "Report Bug"
  },
  "pt-br": {
    "nav_features": "Funcionalidades",
    "nav_install": "Instalação",
    "nav_download": "Download Alpha",
    "badge_alpha": "Versão Alpha Disponível",
    "hero_title": "O Motor Blindado<br>para sua Simulação",
    "hero_desc": "Um sistema ELD/HOS persistente, resiliente a crashes e com auditoria completa para American Truck Simulator e Euro Truck Simulator 2.",
    "btn_download": "Baixar Agora",
    "feat_1_title": "Nunca Perca o Progresso",
    "feat_1_desc": "Seu progresso salvo atomicamente. Crash do jogo ou PC desligado? Sem problemas. O SimDuty recupera o estado exato da sua viagem.",
    "feat_2_title": "Regras Reais de Direção",
    "feat_2_desc": "Regras de Hours of Service (EUA, Canadá, Brasil, UE) com troca dinâmica. Ciclos de descanso, condução e serviço calculados com precisão.",
    "feat_3_title": "Comprovante de Viagem",
    "feat_3_desc": "Cada evento é registrado em um Ledger criptograficamente encadeado (SHA256). Ideal para VTCs que exigem prova de integridade.",
    "dl_ready_title": "Pronto para rodar?",
    "dl_ready_desc": "Baixe a versão mais recente do SimDuty. Inclui o aplicativo Desktop e os plugins necessários para ATS/ETS2.",
    "dl_btn_zip": "Download .ZIP (Alpha)",
    "dl_compat": "Compatível com Windows 10/11 x64",
    "verify_title": "Validação de Segurança (SHA256)",
    "verify_loading": "Carregando hash...",
    "verify_instr": "Verifique com `Get-FileHash`",
    "verify_btn_copy": "Copiar Hash",
    "verify_btn_copied": "Copiado!",
    "inst_title": "Como Instalar",
    "inst_step_1_title": "Extrair",
    "inst_step_1_desc": "Descompacte o arquivo <code>SimDuty-Release.zip</code> em uma pasta de sua preferência (ex: <code>Documentos/SimDuty</code>).",
    "inst_step_2_title": "Instalar Plugins",
    "inst_step_2_desc": "Copie as DLLs da pasta <code>plugins</code> para a pasta de plugins do jogo:",
    "inst_step_3_title": "Executar",
    "inst_step_3_desc": "Abra o <code>SimDuty.exe</code>. O sistema irá detectar o jogo automaticamente quando você entrar na cabine.",
    "footer_rights": "&copy; 2026 SimDuty Project. Distribuído sob licença MIT.<br>Não afiliado à SCS Software.",
    "footer_roadmap": "Roadmap",
    "footer_bug": "Reportar Bug"
  },
  "es": {
    "nav_features": "Características",
    "nav_install": "Instalación",
    "nav_download": "Descargar Alpha",
    "badge_alpha": "Versión Alpha Disponible",
    "hero_title": "El Motor Blindado<br>para tu Simulación",
    "hero_desc": "Un sistema ELD/HOS persistente, resistente a fallos y con auditoría completa para American Truck Simulator y Euro Truck Simulator 2.",
    "btn_download": "Descargar Ahora",
    "feat_1_title": "Nunca Pierdas Progreso",
    "feat_1_desc": "Tu progreso guardado atómicamente. ¿Juego cerrado o PC apagada? Sin problemas. SimDuty restaura el estado exacto de tu viaje.",
    "feat_2_title": "Reglas de Conducción Reales",
    "feat_2_desc": "Reglas de Horas de Servicio (EE.UU., Canadá, Brasil, UE) con cambio dinámico. Ciclos de descanso, conducción y servicio calculados con precisión.",
    "feat_3_title": "Prueba de Viaje",
    "feat_3_desc": "Cada evento se registra en un libro mayor encadenado criptográficamente (SHA256). Ideal para VTCs que requieren prueba de integridad.",
    "dl_ready_title": "¿Listo para rodar?",
    "dl_ready_desc": "Descarga la última versión de SimDuty. Incluye la aplicación de escritorio y los plugins necesarios para ATS/ETS2.",
    "dl_btn_zip": "Descargar .ZIP (Alpha)",
    "dl_compat": "Compatible con Windows 10/11 x64",
    "verify_title": "Validación de Seguridad (SHA256)",
    "verify_loading": "Cargando hash...",
    "verify_instr": "Verificar con `Get-FileHash`",
    "verify_btn_copy": "Copiar Hash",
    "verify_btn_copied": "¡Copiado!",
    "inst_title": "Cómo Instalar",
    "inst_step_1_title": "Extraer",
    "inst_step_1_desc": "Descomprime el archivo <code>SimDuty-Release.zip</code> en una carpeta de tu elección (ej: <code>Documentos/SimDuty</code>).",
    "inst_step_2_title": "Instalar Plugins",
    "inst_step_2_desc": "Copia las DLLs de la carpeta <code>plugins</code> a la carpeta de plugins del juego:",
    "inst_step_3_title": "Ejecutar",
    "inst_step_3_desc": "Abre <code>SimDuty.exe</code>. El sistema detectará automáticamente el juego cuando entres en la cabina.",
    "footer_rights": "&copy; 2026 Proyecto SimDuty. Distribuido bajo licencia MIT.<br>No afiliado a SCS Software.",
    "footer_roadmap": "Roadmap",
    "footer_bug": "Reportar Error"
  },
  "ru": {
    "nav_features": "Функции",
    "nav_install": "Установка",
    "nav_download": "Скачать Alpha",
    "badge_alpha": "Доступна Alpha-версия",
    "hero_title": "Бронированный Двигатель<br>для вашего Симулятора",
    "hero_desc": "Система ELD/HOS с постоянным сохранением, устойчивая к сбоям и с полным аудитом для American Truck Simulator и Euro Truck Simulator 2.",
    "btn_download": "Скачать Сейчас",
    "feat_1_title": "Никогда не теряйте прогресс",
    "feat_1_desc": "Ваш прогресс сохраняется атомарно. Сбой игры или отключение ПК? Нет проблем. SimDuty восстанавливает точное состояние вашего рейса.",
    "feat_2_title": "Реальные правила вождения",
    "feat_2_desc": "Правила режима труда и отдыха (США, Канада, Бразилия, ЕС) с динамическим переключением. Точный расчет циклов отдыха и вождения.",
    "feat_3_title": "Подтверждение рейса",
    "feat_3_desc": "Каждое событие записывается в криптографически связанный журнал (SHA256). Идеально для VTC, требующих подтверждения честности.",
    "dl_ready_title": "Готовы к поездке?",
    "dl_ready_desc": "Скачайте последнюю версию SimDuty. Включает приложение для рабочего стола и необходимые плагины для ATS/ETS2.",
    "dl_btn_zip": "Скачать .ZIP (Alpha)",
    "dl_compat": "Совместимо с Windows 10/11 x64",
    "verify_title": "Проверка безопасности (SHA256)",
    "verify_loading": "Загрузка хэша...",
    "verify_instr": "Проверить с помощью `Get-FileHash`",
    "verify_btn_copy": "Копировать Хэш",
    "verify_btn_copied": "Скопировано!",
    "inst_title": "Как установить",
    "inst_step_1_title": "Распаковать",
    "inst_step_1_desc": "Распакуйте <code>SimDuty-Release.zip</code> в любую папку (например, <code>Документы/SimDuty</code>).",
    "inst_step_2_title": "Установить плагины",
    "inst_step_2_desc": "Скопируйте DLL из папки <code>plugins</code> в папку плагинов игры:",
    "inst_step_3_title": "Запустить",
    "inst_step_3_desc": "Откройте <code>SimDuty.exe</code>. Система автоматически обнаружит игру, когда вы сядете в кабину.",
    "footer_rights": "&copy; 2026 SimDuty Project. Лицензия MIT.<br>Не связано с SCS Software.",
    "footer_roadmap": "План развития",
    "footer_bug": "Сообщить об ошибке"
  }
};

document.addEventListener('DOMContentLoaded', () => {
  const hashElement = document.getElementById('sha256-hash');
  const copyBtn = document.getElementById('copy-hash-btn');
  const hashUrl = 'releases/latest/SHA256SUMS.txt';
  const langSelect = document.getElementById('language-selector');

  // --- I18n Logic ---
  function setLanguage(lang) {
    if (!translations[lang]) lang = 'en'; // fallback

    document.documentElement.lang = lang;
    const t = translations[lang];

    document.querySelectorAll('[data-i18n]').forEach(el => {
      const key = el.getAttribute('data-i18n');
      if (t[key]) {
        el.innerHTML = t[key];
      }
    });

    // Save preference
    localStorage.setItem('simduty_lang', lang);
  }

  // Detect language
  const savedLang = localStorage.getItem('simduty_lang');
  const browserLang = navigator.language.split('-')[0].toLowerCase();

  // Check if browser lang is supported, otherwise default to 'en'
  const initialLang = savedLang || (translations[browserLang] ? browserLang : 'en');

  // Update selector and set text
  if (langSelect) {
    langSelect.value = initialLang;
    langSelect.addEventListener('change', (e) => {
      setLanguage(e.target.value);
    });
  }

  setLanguage(initialLang);


  // --- SHA256 Logic ---
  async function fetchHash() {
    try {
      const response = await fetch(hashUrl);
      if (!response.ok) throw new Error('Fetch failed');

      const text = await response.text();
      const hash = text.split(/\s+/)[0];

      if (hashElement) {
        hashElement.textContent = hash;
      }
    } catch (error) {
      console.warn('SHA256 fetch error:', error);
      if (hashElement) {
        hashElement.textContent = 'Error loading hash (check manually)';
        hashElement.style.color = 'var(--status-critical)';
      }
    }
  }

  if (copyBtn && hashElement) {
    copyBtn.addEventListener('click', () => {
      const hash = hashElement.textContent;
      if (!hash) return;

      const currentLang = document.documentElement.lang || 'en';
      const originalText = translations[currentLang]['verify_btn_copy'];
      const copiedText = translations[currentLang]['verify_btn_copied'];

      navigator.clipboard.writeText(hash).then(() => {
        copyBtn.textContent = copiedText;
        setTimeout(() => {
          // Reset text based on CURRENT language
          const activeLang = document.documentElement.lang || 'en';
          copyBtn.textContent = translations[activeLang]['verify_btn_copy'];
        }, 2000);
      }).catch(err => console.error(err));
    });
  }

  fetchHash();
});
